{% extends 'base.html' %}  
{% block content %}
<div class="container py-5">
    <!-- Page Header -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h1 class="display-4 fw-bold text-primary mb-3">Our Projects and Services</h1>
            <p class="lead">We work hard to provide women and children with better life opportunities through our various projects</p>
        </div>
    </div>

    <!-- Program Categories Filter -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-4">Choose Project Type</h5>
                    <div class="row g-3" id="categoryFilters">
                        <div class="col-auto">
                            <button class="btn btn-outline-primary active filter-btn" data-category="all">
                                All Projects
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-outline-primary filter-btn" data-category="education">
                                <i class="fas fa-graduation-cap me-2"></i>Education & Training
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-outline-primary filter-btn" data-category="health">
                                <i class="fas fa-heartbeat me-2"></i>Health & Reproductive
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-outline-primary filter-btn" data-category="economic">
                                <i class="fas fa-hand-holding-usd me-2"></i>Economic Empowerment
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-outline-primary filter-btn" data-category="advocacy">
                                <i class="fas fa-bullhorn me-2"></i>Advocacy & Awareness
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Programs Grid -->
    <div class="row g-4" id="programsGrid">
        <!-- Programs will be loaded dynamically via JavaScript -->
        <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading projects...</p>
        </div>
    </div>

    <!-- Program Statistics -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-primary text-white">
                <div class="card-body py-5">
                    <div class="row text-center">
                        <div class="col-md-3 mb-4 mb-md-0">
                            <h3 class="display-4 fw-bold" id="totalPrograms">0</h3>
                            <p class="mb-0">Ongoing Projects</p>
                        </div>
                        <div class="col-md-3 mb-4 mb-md-0">
                            <h3 class="display-4 fw-bold" id="educationPrograms">0</h3>
                            <p class="mb-0">Education Projects</p>
                        </div>
                        <div class="col-md-3 mb-4 mb-md-0">
                            <h3 class="display-4 fw-bold" id="healthPrograms">0</h3>
                            <p class="mb-0">Health Projects</p>
                        </div>
                        <div class="col-md-3">
                            <h3 class="display-4 fw-bold" id="economicPrograms">0</h3>
                            <p class="mb-0">Economic Projects</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card shadow-lg border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body py-5 text-white text-center">
                    <h3 class="mb-3">Do You Want to See Our Project Succeed?</h3>
                    <p class="lead mb-4">Join us as a member, donor, or volunteer</p>
                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3">
                        <a href="{% url 'membership' %}" class="btn btn-light btn-lg">
                            <i class="fas fa-user-plus me-2"></i>Join Now
                        </a>
                        <a href="{% url 'donation' %}" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-donate me-2"></i>Donate to Project
                        </a>
                        <a href="{% url 'contact' %}" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-hands-helping me-2"></i>Volunteer
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Program Details Modal -->
<div class="modal fade" id="programModal" tabindex="-1" aria-labelledby="programModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="programModalLabel">Project Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="programModalBody">
                <!-- Project details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="{% url 'donation' %}" class="btn btn-primary">
                    <i class="fas fa-donate me-2"></i>Donate to This Project
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.program-card {
    transition: all 0.3s ease;
    border: none;
    border-radius: 15px;
    overflow: hidden;
    height: 100%;
}

.program-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 30px rgba(0,0,0,0.1);
}

.program-image {
    height: 200px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3rem;
}

.program-category {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 2;
}

.filter-btn.active {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
}

.program-stats {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
}

.category-education { border-left: 4px solid #28a745; }
.category-health { border-left: 4px solid #dc3545; }
.category-economic { border-left: 4px solid #ffc107; }
.category-advocacy { border-left: 4px solid #17a2b8; }

.spinner-border {
    width: 3rem;
    height: 3rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Program data structure
const programCategories = {
    'education': {
        name: 'Education & Training',
        icon: 'fa-graduation-cap',
        color: 'success'
    },
    'health': {
        name: 'Health & Reproductive',
        icon: 'fa-heartbeat',
        color: 'danger'
    },
    'economic': {
        name: 'Economic Empowerment',
        icon: 'fa-hand-holding-usd',
        color: 'warning'
    },
    'advocacy': {
        name: 'Advocacy & Awareness',
        icon: 'fa-bullhorn',
        color: 'info'
    }
};

// Load programs from API
async function loadPrograms() {
    try {
        const response = await fetch('/api/programs/');
        const programs = await response.json();
        displayPrograms(programs);
        updateProgramStats(programs);
    } catch (error) {
        console.error('Error loading programs:', error);
        document.getElementById('programsGrid').innerHTML = `
            <div class="col-12 text-center">
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Error loading projects. Please try again later.
                </div>
            </div>
        `;
    }
}

// Display programs in grid
function displayPrograms(programs, filterCategory = 'all') {
    const grid = document.getElementById('programsGrid');
    
    if (programs.length === 0) {
        grid.innerHTML = `
            <div class="col-12 text-center">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    No projects available at the moment.
                </div>
            </div>
        `;
        return;
    }

    let filteredPrograms = programs;
    if (filterCategory !== 'all') {
        filteredPrograms = programs.filter(program => program.category === filterCategory);
    }

    grid.innerHTML = '';

    filteredPrograms.forEach(program => {
        const category = programCategories[program.category];
        const programHTML = `
            <div class="col-lg-4 col-md-6 mb-4 program-item" data-category="${program.category}">
                <div class="card program-card h-100 shadow-sm">
                    <div class="program-image">
                        <i class="fas ${category.icon}"></i>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <span class="badge bg-${category.color}">${category.name}</span>
                            <small class="text-muted">
                                <i class="fas fa-calendar me-1"></i>
                                ${new Date(program.start_date).toLocaleDateString('en-US')}
                            </small>
                        </div>
                        <h5 class="card-title">${program.title}</h5>
                        <p class="card-text">${program.description.substring(0, 120)}...</p>
                    </div>
                    <div class="card-footer bg-transparent">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary btn-sm view-program-btn" 
                                    data-program-id="${program.id}">
                                <i class="fas fa-eye me-2"></i>View Details
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        grid.innerHTML += programHTML;
    });

    // Add event listeners to view buttons
    document.querySelectorAll('.view-program-btn').forEach(button => {
        button.addEventListener('click', function() {
            const programId = this.getAttribute('data-program-id');
            showProgramDetails(programId, programs);
        });
    });
}

// Show program details in modal
function showProgramDetails(programId, programs) {
    const program = programs.find(p => p.id == programId);
    const category = programCategories[program.category];
    
    const modalBody = document.getElementById('programModalBody');
    modalBody.innerHTML = `
        <div class="row">
            <div class="col-md-4">
                <div class="program-image rounded mb-3">
                    <i class="fas ${category.icon} fa-3x"></i>
                </div>
                <div class="mb-3">
                    <span class="badge bg-${category.color} fs-6">${category.name}</span>
                </div>
                <div class="program-info">
                    <p><strong><i class="fas fa-calendar me-2"></i>Start Date:</strong><br>
                    ${new Date(program.start_date).toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })}</p>
                    
                    ${program.end_date ? `
                    <p><strong><i class="fas fa-calendar-check me-2"></i>End Date:</strong><br>
                    ${new Date(program.end_date).toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })}</p>
                    ` : ''}
                    
                    <p><strong><i class="fas fa-info-circle me-2"></i>Status:</strong><br>
                    <span class="badge ${program.is_active ? 'bg-success' : 'bg-secondary'}">
                        ${program.is_active ? 'Ongoing' : 'Completed'}
                    </span></p>
                </div>
            </div>
            <div class="col-md-8">
                <h4 class="text-primary">${program.title}</h4>
                <p class="lead">${program.description}</p>
                
                <div class="mt-4">
                    <h6><i class="fas fa-bullseye me-2"></i>Project Goals</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success me-2"></i> Empower women with life skills</li>
                        <li><i class="fas fa-check text-success me-2"></i> Improve access to healthcare services</li>
                        <li><i class="fas fa-check text-success me-2"></i> Provide economic opportunities</li>
                        <li><i class="fas fa-check text-success me-2"></i> Increase community awareness and participation</li>
                    </ul>
                </div>
            </div>
        </div>
    `;
    
    const modal = new bootstrap.Modal(document.getElementById('programModal'));
    modal.show();
}

// Update program statistics
function updateProgramStats(programs) {
    const total = programs.length;
    const education = programs.filter(p => p.category === 'education').length;
    const health = programs.filter(p => p.category === 'health').length;
    const economic = programs.filter(p => p.category === 'economic').length;
    
    // Animate counters
    animateCounter('totalPrograms', total);
    animateCounter('educationPrograms', education);
    animateCounter('healthPrograms', health);
    animateCounter('economicPrograms', economic);
}

// Animated counter
function animateCounter(elementId, target) {
    const element = document.getElementById(elementId);
    let current = 0;
    const increment = target / 50;
    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            element.textContent = target;
            clearInterval(timer);
        } else {
            element.textContent = Math.floor(current);
        }
    }, 30);
}

// Filter programs by category
function setupCategoryFilters() {
    document.querySelectorAll('.filter-btn').forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            this.classList.add('active');
            
            // Get category and filter programs
            const category = this.getAttribute('data-category');
            loadPrograms().then(programs => {
                displayPrograms(programs, category);
            });
        });
    });
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadPrograms();
    setupCategoryFilters();
});
</script>
{% endblock %}
